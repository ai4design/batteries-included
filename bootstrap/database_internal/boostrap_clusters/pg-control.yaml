---
# Auto-generated by Bootstrap.dump
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  labels:
    app: postgres-operator
    battery/app: postgres-operator
    battery/managed: 'true'
    battery/owner: bootstrapped
    sidecar.istio.io/inject: disabled
  name: pg-control
  namespace: battery-core
spec:
  databases:
    control: controlserver
  numberOfInstances: 1
  patroni:
    pg_hba:
      - local	all	all	trust
      - host	all	all	127.0.0.1/32	scram-sha-256
      - host	all	all	::1/128	scram-sha-256
      - hostssl	replication	standby	all	scram-sha-256
      - hostnossl	all	postgres	0.0.0.0/0	scram-sha-256
      - hostssl	all	postgres	0.0.0.0/0	scram-sha-256
      - hostssl	all	all	all	scram-sha-256
      - hostnossl	all	all	all	scram-sha-256
      - hostnossl	all	all	all	reject
  postgresql:
    parameters:
      log_destination: stderr
      logging_collector: 'false'
      password_encryption: scram-sha-256
    version: '14'
  sidecars:
    - env:
        - name: DATA_SOURCE_URI
          value: pg-control?sslmode=disable
        - name: DATA_SOURCE_USER
          valueFrom:
            secretKeyRef:
              key: username
              name: postgres.pg-control.credentials.postgresql.acid.zalan.do
        - name: DATA_SOURCE_PASS
          valueFrom:
            secretKeyRef:
              key: password
              name: postgres.pg-control.credentials.postgresql.acid.zalan.do
        - name: PG_EXPORTER_AUTO_DISCOVER_DATABASES
          value: 'true'
      image: quay.io/prometheuscommunity/postgres-exporter:v0.11.1 
      name: metrics-exporter
      ports:
        - containerPort: 9187
          name: exporter
          protocol: TCP
      resources:
        limits:
          cpu: 200m
          memory: 256M
        requests:
          cpu: 100m
          memory: 256M
  teamId: pg
  users:
    controlserver:
      - superuser
      - createrole
      - createdb
      - login
  volume:
    size: 200M

